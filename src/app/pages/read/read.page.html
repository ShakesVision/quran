<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title> {{title}} </ion-title>
    <ion-buttons slot="end">
      <ion-button
        (click)="toggleHifzMode()"
        slot="end"
        [ngClass]="!hMode?'emphasize-btn':''"
      >
        <ion-icon
          slot="icon-only"
          [name]="hMode?toggleIconOutline('eye'):toggleIconOutline('eye-outline')"
        ></ion-icon>
      </ion-button>
      <ion-button
        *ngIf="translationExists"
        (click)="translationMode(true)"
        slot="end"
        [ngClass]="tMode?'emphasize-btn':''"
      >
        <ion-icon
          slot="icon-only"
          [name]="tMode?toggleIconOutline('language-outline'):toggleIconOutline('language')"
        ></ion-icon>
      </ion-button>

      <ion-button id="popover-trigger-button" slot="end">
        <ion-icon slot="icon-only" name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-wrapper ar ar2 ion-margin-top">
    <div class="page-top-info">
      <ng-container *ngIf="currentPage>1 && pages.length ===611">
        <span class="juz-number">
          {{ surahCalculated === 1?
          'سورۃ':(surahService.juzNames[juzCalculated-1] + ' ' +
          surahService.e2a(juzCalculated.toString())) }}
        </span>
        <span class="page-number">
          {{ surahService.e2a(currentPage.toString()) }}
        </span>
        <span class="surah-number">
          {{ surahService.surahNames[surahCalculated-1] + ' ' +
          surahService.e2a(surahCalculated.toString()) }}
        </span>
      </ng-container>
    </div>
    <div class="content-wrapper">
      <ng-container
        class="ion-text-center"
        *ngIf="currentPage==1 && lines?.length<15 && !juzmode"
      >
        <div
          class="filler-lines"
          *ngFor="let line of [].constructor(15-lines?.length-2)"
        ></div>
        <div class="surah-name centered-table-text">
          {{surah?.name?.split(' ')[1]|| title}}
        </div>
        <div class="bism centered-table-text">﷽</div>
      </ng-container>
      <div
        *ngFor="let line of lines;let i = index"
        id="line_{{i}}"
        class="line"
        style="position: relative"
        [ngClass]="{'quran-kareem-text':juzmode && pages.length ==611 && currentPage==1,
        'bism-line': line?.trim()==='﷽' || (pages.length ===611 && currentPage === pages.length && i==10), 
        'surah-start-line':lines[i+1]?.trim()==='﷽', 
        'surah-end-line':i===lines.length-1&&pages[currentPage]?.split('\n')[1]?.trim()==='﷽'||lines[i+2]?.trim()==='﷽' || (pages.length ===611 && currentPage === pages.length && (i==lines.length-1 || i==9))}"
        (click)="openTrans($event,i)"
      >
        <div
          *ngIf="line.includes(surahService.diacritics.RUKU_MARK)"
          class="ruku-wrapper"
          [innerHTML]="addIndicators(line,i)"
        ></div>
        <span> {{line}} </span>
      </div>
      <ng-container
        *ngIf="currentPage==pages?.length && pages?.length!=1 && lines.length<15"
      >
        <div
          class="filler-lines"
          *ngFor="let line of [].constructor(15-lines.length)"
        ></div>
      </ng-container>
    </div>
  </div>
  <!-- <div class="next-words ar ar2 ion-text-end">
    {{pages[currentPage]?.split("\n")[0].split(" ")[0]}}
  </div> -->

  <div class="popup ion-text-center">
    <div class="popup-header"></div>
    <div class="popup-text"></div>
    <ion-button
      style="font-size: x-small"
      fill="outline"
      size="small"
      color="dark"
      class="cross"
    >
      <ion-icon slot="icon-only" name="close"></ion-icon>
    </ion-button>
  </div>

  <ion-popover
    [isOpen]="isPopoverOpen"
    trigger="popover-trigger-button"
    side="bottom"
  >
    <ng-template>
      <ion-content>
        <div class="popover-wrapper">
          <ion-list lines="none">
            <ion-item>
              <ion-label>Font Size</ion-label>
              <ion-button (click)="changeFontSize(1)" slot="end" fill="clear">
                <ion-icon slot="icon-only" name="add-circle-outline"></ion-icon>
              </ion-button>
              <!-- <ion-input
                slot="end"
                placeholder="px"
                (ionChange)="changeFontSize($event.target.value,true)"
                [debounce]="500"
                class="font-size-field ion-no-padding ion-no-margin ion-text-center"
              ></ion-input> -->
              <div slot="end" class="font-size-field"></div>
              <ion-button (click)="changeFontSize(-1)" slot="end" fill="clear">
                <ion-icon
                  slot="icon-only"
                  name="remove-circle-outline"
                ></ion-icon>
              </ion-button>
            </ion-item>
            <ion-item>
              <ion-label>Go to</ion-label>
              <ng-container slot="end">
                <ion-input
                  slot="end"
                  placeholder="juz"
                  (ionChange)="gotoJuzSurah($event.target.value,'juz')"
                  [debounce]="500"
                  class="ion-no-padding ion-no-margin ion-text-center"
                ></ion-input>
                <ion-input
                  slot="end"
                  placeholder="surah"
                  (ionChange)="gotoJuzSurah($event.target.value,'surah')"
                  [debounce]="500"
                  class="ion-no-padding ion-no-margin ion-text-center"
                ></ion-input>
              </ng-container>
            </ion-item>
            <!-- <ion-item>
              <ion-label>Go to Surah</ion-label>
            </ion-item> -->
            <ion-item>
              <ion-label>Background</ion-label>
              <ion-input
                slot="end"
                placeholder="css color / url"
                (ionChange)="changeColors($event.target.value,'bg')"
                [debounce]="1000"
                class="ion-no-padding ion-no-margin ion-text-center"
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-label>Color</ion-label>
              <ion-input
                slot="end"
                placeholder="css color"
                (ionChange)="changeColors($event.target.value,'color')"
                [debounce]="1000"
                class="ion-no-padding ion-no-margin ion-text-center"
              ></ion-input>
            </ion-item>
            <ion-item button *ngIf="!juzmode" (click)="showSurahInfo()">
              <ion-icon slot="start" name="information"></ion-icon>
              <ion-label>About Surah</ion-label>
            </ion-item>
            <ion-item button (click)="toggleMuhammadiFont()">
              <ion-icon slot="start" name="refresh"></ion-icon>
              <ion-label>Change Font</ion-label>
            </ion-item>
            <ion-card>
              <ion-item color="light">
                <ion-input
                  placeholder="بحث / SEARCH / تلاش"
                  (ionChange)="onSearchChange($event)"
                  [debounce]="1000"
                  clearInput
                  class="ion-no-padding ion-text-center ar2"
                ></ion-input>
              </ion-item>
              <ion-item style="font-size: small">
                <ion-label>Ignore Tashkeel</ion-label>
                <ion-toggle
                  slot="end"
                  [checked]="ignoreTashkeel"
                  (ionChange)="ignoreTashkeel=!ignoreTashkeel"
                ></ion-toggle>
              </ion-item>
            </ion-card>
            <div *ngIf="searchResults" class="ion-text-center result-heading">
              <ion-label>Results: {{searchResults.length}}</ion-label>
            </div>
            <ion-item
              button
              class="rtl"
              style="position: relative"
              *ngFor="let r of searchResults;let i=index"
              (click)="gotoPageAndHighlightLine(r.pageIndex,r.lineIndex)"
            >
              <div class="indices ion-margin-end">
                <span class="index">{{i+1}}</span>
                <span class="location">{{r.pageIndex+1}}</span>
              </div>
              <ion-label class="ar2 small-text"
                >{{getLineTextFromIndices(+r.pageIndex,+r.lineIndex)}}</ion-label
              >
            </ion-item>
          </ion-list>
        </div>
      </ion-content>
    </ng-template>
  </ion-popover>
</ion-content>
<ion-footer>
  <div class="btmNav">
    <ion-button
      shape="round"
      fill="clear"
      [disabled]="currentPage==pages?.length"
      (click)="goToPage(1)"
    >
      <ion-icon name="chevron-back-circle-outline"></ion-icon>
    </ion-button>
    <ion-label style="font-size: small"
      >Page
      <ion-input
        class="page-num-input"
        type="number"
        [ngModel]="currentPage"
        (keyup.enter)="gotoPageNum($event.target.value)"
      ></ion-input>
      of {{pages?.length}}
    </ion-label>
    <ion-button
      shape="round"
      fill="clear"
      [disabled]="currentPage==1"
      (click)="goToPage(-1)"
    >
      <ion-icon name="chevron-forward-circle-outline"></ion-icon>
    </ion-button>
  </div>
</ion-footer>
